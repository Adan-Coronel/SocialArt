extends layout

block content
  link(rel="stylesheet", href="/estadisticas.css")
  .estadisticas-page-container
    .estadisticas-page-header
      h1 游늵 Mis Estad칤sticas
      p Resumen de tu actividad en SocialArt

    .estadisticas-content-page
      .loading Cargando estad칤sticas...

  script(src="/estadisticas.js")
  script.
    class EstadisticasPageManager {
      constructor() {
        this.container = document.querySelector('.estadisticas-content-page')
        this.cargarEstadisticas()
      }

      async cargarEstadisticas() {
        try {
          this.container.innerHTML = '<div class="loading">Cargando estad칤sticas...</div>'

          const response = await fetch("/estadisticas/perfil")
          const data = await response.json()

          if (data.success) {
            this.mostrarEstadisticas(data.estadisticas)
          } else {
            this.container.innerHTML =
              '<div class="error">Error al cargar estad칤sticas: ' + (data.error || "Error desconocido") + "</div>"
          }
        } catch (err) {
          console.error("Error al cargar estad칤sticas:", err)
          this.container.innerHTML = '<div class="error">Error de conexi칩n: ' + err.message + "</div>"
        }
      }

      mostrarEstadisticas(stats) {
        this.container.innerHTML = `
          <div class="estadisticas-grid-page">
            <div class="estadistica-card-large">
              <div class="estadistica-numero">${stats.totalAlbumes}</div>
              <div class="estadistica-label">츼lbumes Creados</div>
              <div class="estadistica-descripcion">Total de 치lbumes que has creado</div>
            </div>
            <div class="estadistica-card-large">
              <div class="estadistica-numero">${stats.totalImagenes}</div>
              <div class="estadistica-label">Im치genes Subidas</div>
              <div class="estadistica-descripcion">Todas las im치genes en tus 치lbumes</div>
            </div>
            <div class="estadistica-card-large">
              <div class="estadistica-numero">${stats.totalReaccionesRecibidas}</div>
              <div class="estadistica-label">Me Gusta Recibidos</div>
              <div class="estadistica-descripcion">Reacciones en todas tus im치genes</div>
            </div>
            <div class="estadistica-card-large">
              <div class="estadistica-numero">${stats.totalComentariosRecibidos}</div>
              <div class="estadistica-label">Comentarios Recibidos</div>
              <div class="estadistica-descripcion">Comentarios en todas tus im치genes</div>
            </div>
          </div>

          <div class="estadisticas-detalle">
            <div class="album-popular-large">
              <h3>游끥 츼lbum M치s Popular</h3>
              ${
                stats.albumMasPopular
                  ? `
                <div class="album-info">
                  <h4>${stats.albumMasPopular.titulo}</h4>
                  <p>${stats.albumMasPopular.totalReacciones} reacciones</p>
                  <small>Este es tu 치lbum con m치s interacciones</small>
                </div>
              `
                  : `
                <div class="album-info">
                  <p>A칰n no tienes 치lbumes con reacciones</p>
                  <small>Comparte m치s contenido para generar interacciones</small>
                </div>
              `
              }
            </div>

            <div class="actividad-reciente-large">
              <h3>游늳 Actividad Reciente (칰ltimos 30 d칤as)</h3>
              <div class="actividad-grid">
                <div class="actividad-item-large">
                  <span class="actividad-numero">${stats.actividadReciente.imagenesSubidas}</span>
                  <span class="actividad-texto">Im치genes subidas</span>
                </div>
                <div class="actividad-item-large">
                  <span class="actividad-numero">${stats.actividadReciente.comentariosRecibidos}</span>
                  <span class="actividad-texto">Comentarios recibidos</span>
                </div>
                <div class="actividad-item-large">
                  <span class="actividad-numero">${stats.actividadReciente.reaccionesRecibidas}</span>
                  <span class="actividad-texto">Reacciones recibidas</span>
                </div>
              </div>
            </div>
          </div>

          <div class="consejos-section">
            <h3>游눠 Consejos para mejorar tu perfil</h3>
            <div class="consejos-grid">
              ${stats.totalImagenes < 10 ? '<div class="consejo">游닞 Sube m치s im치genes para mostrar tu trabajo</div>' : ''}
              ${stats.totalAlbumes < 3 ? '<div class="consejo">游늬 Crea m치s 치lbumes para organizar tu arte</div>' : ''}
              ${stats.totalReaccionesRecibidas < 5 ? '<div class="consejo">仇벒잺 Interact칰a con otros artistas para recibir m치s reacciones</div>' : ''}
              ${stats.totalComentariosRecibidos < 3 ? '<div class="consejo">游눫 Comenta en otros 치lbumes para generar conversaciones</div>' : ''}
              ${stats.totalImagenes >= 10 && stats.totalAlbumes >= 3 && stats.totalReaccionesRecibidas >= 5 && stats.totalComentariosRecibidos >= 3 ?'<div class="consejo">Tu perfil se ve re bien :D</div>' : ''}
            </div>
          </div>
        `
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      new EstadisticasPageManager()
    })

    